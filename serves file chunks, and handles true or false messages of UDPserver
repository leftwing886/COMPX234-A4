def main():
    if len(sys.argv) != 2:
        print("Usage: python3 UDPserver.py <port>")
        sys.exit(1)

    port = int(sys.argv[1])
    server_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    server_socket.bind(("", port))
    print(f"Server running on port {port}")

    while True:
        try:
            request, client_address = server_socket.receivefrom(4096)
            parts = request.decode().strip().split()
            if len(parts) != 2 or parts[0] != "DOWNLOAD":
                continue

            filename = parts[1]
            if not os.path.isfile(filename):
                server_socket.sendto(f"ERR {filename} NOT_FOUND".encode(), client_address)
                continue

            # Start new thread for file transmission
            threading.Thread(target=handle_file_transmission, args=(filename, client_address, port)).start()
        except Exception as e:
            print(f"Server error: {e}")


if __name__ == "__main__":
    main()
