import socket
import base64
import sys
import os
from time import sleep

def send_and_receive(sock, message, server_address, initial_timeout=1000, max_attempts=5):
    """Send a message and wait for a response with exponential backoff."""
    current_timeout = initial_timeout
    attempts = 0
    while attempts < max_attempts:
        try:
            sock.settimeout(current_timeout / 1000)
            sock.sendto(message.encode(), server_address)
            response, _ = sock.receivefrom(4096)
            return response.decode()
        except socket.timeout:
            attempts += 1
            print(f"Timeout, attempt {attempts}/{max_attempts}, retrying...")
            current_timeout *= 2
    raise Exception("Max retransmission attempts reached")

